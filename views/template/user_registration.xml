<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <template id="register_template" name="Register">
        <t t-call-assets="web.assets_frontend"/>
        <!-- Link Custom CSS -->
        <link rel="stylesheet" type="text/css" href="/auction_management/static/src/css/auction.css"/>
        <script type="text/javascript" src="/auction_management/static/src/js/otp.js"></script>       
        

        <t t-set="title">Register - Auction Management System</t>
        <div class="container mt-5">
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <div class="card shadow-lg border-0 rounded-3">
                        <div class="card-body p-5">
                            <h2 class="text-center mb-4 fw-bold">Create an Account</h2>
                            <form action="/auction/register/submit" method="post" id="registerForm">
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="name" class="form-label">Full Name</label>
                                        <input type="text" class="form-control" name="name" id="name" placeholder="Enter your full name" required="1"/>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="email" class="form-label">Email</label>
                                        <input type="email" class="form-control" name="email" id="email" placeholder="Enter your email" required="1"/>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label for="password" class="form-label">Password</label>
                                        <input type="password" class="form-control" name="password" id="password" placeholder="Create a password" required="1"/>
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label for="confirm_password" class="form-label">Confirm Password</label>
                                        <input type="password" class="form-control" name="confirm_password" id="confirm_password" placeholder="Confirm your password" required="1"/>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="phone" class="form-label">Phone</label>
                                    <input type="tel" class="form-control" name="phone" id="phone" placeholder="Enter your phone number"/>
                                </div>
                                <div class="mb-3">
                                    <label for="address" class="form-label">Address</label>
                                    <textarea class="form-control" name="address" id="address" rows="3" placeholder="Enter your address"></textarea>
                                </div>

                                <!-- OTP Section -->
                                <div class="mb-3">
                                    <label for="otp" class="form-label">Enter OTP</label>
                                    <input type="text" class="form-control" name="otp" id="otp" placeholder="Enter OTP" required="1" disabled="1"/>
                                    <button type="button" id="sendOtpButton" class="btn btn-secondary mt-2">Send OTP</button>
                                    <button type="button" id="verifyOtpButton" class="btn btn-info mt-2" disabled="1">Verify OTP</button>
                                </div>

                                <div class="d-grid">
                                    <button type="submit" class="btn btn-primary btn-lg" id="registerButton" disabled="1">Register</button>
                                </div>
                            </form>
                            <p class="mt-4 text-center">
                                <a href="/auction/login" class="text-decoration-none">Already have an account? Login here.</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <script>
        document.getElementById('verifyOtpButton').addEventListener('click', function() {
        var otp = document.getElementById('otp').value;
        var email = document.getElementById('email').value;

        if (!otp || !email) {
            alert('Please enter the OTP and email first.');
            return;
        }

        fetch('/auction/register/verify_otp', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ otp: otp, email: email })
        })
        .then(response => response.json())
        .then(data => {
            if (data.result.success) {
                alert('OTP Verified successfully!');
                document.getElementById('registerButton').disabled = false; // Enable Register button
            } else {
                alert(data.error || 'Failed to verify OTP. Please try again.');
            }
        })
        .catch(error => {
            alert('Error: ' + error);
        });
    });

        </script>

    </template>
</odoo>
